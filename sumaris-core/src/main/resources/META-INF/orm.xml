<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings xmlns="http://java.sun.com/xml/ns/persistence/orm" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm http://java.sun.com/xml/ns/persistence/orm_1_0.xsd" version="1.0">

  <named-query name="lastSystemVersion">
    <query>
    <![CDATA[
    SELECT
      label as systemVersion
    FROM
      SystemVersion
    WHERE
      id = (select max(id) from SystemVersion)
    ]]>
    </query>
  </named-query>

  <named-query name="findPersons">
    <query>
      <![CDATA[
    SELECT
      t
    FROM
      Person t
      inner join fetch t.status s
      inner join fetch t.department d
      left outer join fetch t.userProfiles up
    WHERE
      (:userProfileId is null OR up.id = :userProfileId)
      AND (:statusIds is null OR s.id IN (:statusIds))
      AND (:email is null OR upper(t.email) = upper(:email))
      AND (:pubkey is null OR t.pubkey = :pubkey)
      AND (:firstName is null OR upper(t.firstName) = upper(:firstName))
      AND (:lastName is null OR upper(t.lastName) = upper(:lastName))
    ]]>
    </query>
  </named-query>

  <named-query name="countPersons">
    <query>
      <![CDATA[
      SELECT
        count(distinct t.id)
      FROM
        Person t
        inner join t.status s
        left outer join t.userProfiles up
      WHERE
        (:userProfileId is null OR up.id = :userProfileId)
        AND (:statusIds is null OR s.id IN (:statusIds))
        AND (:email is null OR upper(t.email) = upper(:email))
        AND (:pubkey is null OR t.pubkey = :pubkey)
        AND (:firstName is null OR upper(t.firstName) = upper(:firstName))
        AND (:lastName is null OR upper(t.lastName) = upper(:lastName))
      ]]>
    </query>
  </named-query>

  <!--<named-query name="findDepartments">
    <query>
      <![CDATA[
      SELECT
        t
      FROM
        Department t
        inner join fetch t.status s
      WHERE
        (:statusIds is null OR s.id IN (:statusIds))
        AND (:withLogo is null OR t.logo.id is not null)
      ]]>
    </query>
  </named-query>-->
</entity-mappings>